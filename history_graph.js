
var canvas;
var context;
var viewMatrix;
var drawAreaWidth;
var drawAreaHeight;
var leftMargin = 20;
var bottomMargin = 20;
var rightMargin = 0;
var topMargin = 8;
var dataMaxY = 20;
var dataMaxX = 100;
var dataMinX = 0;

// check also data today from yesterday 
var stationData = "2011,10,12,0,0,23:50,Länsi,0,7,8,6,8\n2011,10,12,0,5,23:50,Länsi,0,7,8,6,8\n2011,10,12,0,35,0:20,Länsi,0,6,8,6,6\n2011,10,12,0,40,0:20,Länsi,0,6,8,6,6\n2011,10,12,0,45,0:30,Länsi,0,6,7,6,5\n2011,10,12,0,50,0:30,Länsi,0,6,7,6,5\n2011,10,12,0,55,0:40,Länsi,0,6,7,6,6\n2011,10,12,1,0,0:50,Länsi,0,7,8,6,7\n2011,10,12,1,5,0:50,Länsi,0,7,8,6,7\n2011,10,12,1,10,0:50,Länsi,0,7,8,6,7\n2011,10,12,1,15,1:00,Länsi,0,7,8,6,7\n2011,10,12,1,20,1:00,Länsi,0,7,8,6,7\n2011,10,12,1,25,1:10,Länsi,0,6,8,6,7\n2011,10,12,1,30,1:10,Länsi,0,6,8,6,7\n2011,10,12,1,35,1:20,Länsi,0,6,7,6,8\n2011,10,12,1,40,1:20,Länsi,0,6,7,6,8\n2011,10,12,1,45,1:30,Länsi,0,6,7,6,8\n2011,10,12,1,50,1:30,Länsi,0,6,7,6,8\n2011,10,12,1,55,1:40,Länsi,0,6,8,6,7\n2011,10,12,2,0,1:40,Länsi,0,6,8,6,7\n2011,10,12,2,5,1:50,Länsi,0,6,7,6,6\n2011,10,12,2,10,1:50,Länsi,0,6,7,6,6\n2011,10,12,2,15,2:00,Länsi,0,6,7,6,6\n2011,10,12,2,20,2:00,Länsi,0,6,7,6,6\n2011,10,12,2,25,2:10,Länsi,0,6,8,6,6\n2011,10,12,2,30,2:20,Länsi,0,6,7,6,7\n2011,10,12,2,35,2:20,Länsi,0,6,7,6,7\n2011,10,12,2,40,2:20,Länsi,0,6,7,6,7\n2011,10,12,2,45,2:30,Länsi,0,6,7,7,1\n2011,10,12,2,50,2:30,Länsi,0,6,7,7,1\n2011,10,12,2,55,2:40,Länsi,0,6,7,7,2\n2011,10,12,3,0,2:40,Länsi,0,6,7,7,2\n2011,10,12,3,5,2:40,Länsi,0,6,7,7,2\n2011,10,12,3,10,3:00,Länsi,0,7,8,7,5\n2011,10,12,3,15,3:00,Länsi,0,7,8,7,5\n2011,10,12,3,20,3:10,Länsi,0,6,7,7,6\n2011,10,12,3,25,3:10,Länsi,0,6,7,7,6\n2011,10,12,3,30,3:20,Länsi,0,6,7,7,6\n2011,10,12,3,35,3:20,Länsi,0,6,7,7,6\n2011,10,12,3,40,3:30,Länsi,0,6,7,7,4\n2011,10,12,3,45,3:30,Länsi,0,6,7,7,4\n2011,10,12,3,50,3:40,Länsi,0,5,7,7,2\n2011,10,12,3,55,3:40,Länsi,0,5,7,7,2\n2011,10,12,4,0,3:50,Länsi,0,6,8,6,7\n2011,10,12,4,5,3:50,Länsi,0,6,8,6,7\n2011,10,12,4,10,3:50,Länsi,0,6,8,6,7\n2011,10,12,4,15,4:00,Luoteis,0,5,7,6,4\n2011,10,12,4,20,4:10,Länsi,0,6,8,6,2\n2011,10,12,4,25,4:10,Länsi,0,6,8,6,2\n2011,10,12,4,30,4:20,Länsi,0,6,8,6,1\n2011,10,12,4,35,4:20,Länsi,0,6,8,6,1\n2011,10,12,4,40,4:20,Länsi,0,6,8,6,1\n2011,10,12,4,45,4:30,Länsi,0,6,8,5,9\n2011,10,12,4,50,4:30,Länsi,0,6,8,5,9\n2011,10,12,4,55,4:40,Länsi,0,5,7,5,7\n2011,10,12,5,0,4:50,Länsi,0,4,6,5,7\n2011,10,12,5,5,4:50,Länsi,0,4,6,5,7\n2011,10,12,5,10,5:00,Länsi,0,4,5,5,7\n2011,10,12,5,15,5:00,Länsi,0,4,5,5,7\n2011,10,12,5,20,5:10,Länsi,0,4,5,5,9\n2011,10,12,5,25,5:10,Länsi,0,4,5,5,9\n2011,10,12,5,30,5:10,Länsi,0,4,5,5,9\n2011,10,12,5,35,5:20,Länsi,0,3,5,5,9\n2011,10,12,5,40,5:20,Länsi,0,3,5,5,9\n2011,10,12,5,45,5:30,Länsi,0,3,4,5,9\n2011,10,12,5,50,5:40,Länsi,0,4,5,6,0\n2011,10,12,5,55,5:40,Länsi,0,4,5,6,0\n2011,10,12,6,0,5:40,Länsi,0,4,5,6,0\n2011,10,12,6,5,5:50,Länsi,0,4,5,5,8\n2011,10,12,6,10,5:50,Länsi,0,4,5,5,8\n2011,10,12,6,15,6:00,Länsi,0,3,4,5,9\n2011,10,12,6,20,6:00,Länsi,0,3,4,5,9\n2011,10,12,6,25,6:10,Länsi,0,3,5,5,9\n2011,10,12,6,30,6:10,Länsi,0,3,5,5,9\n2011,10,12,6,35,6:20,Länsi,0,3,4,5,9\n2011,10,12,6,40,6:30,Länsi,0,2,3,5,9\n2011,10,12,6,45,6:30,Länsi,0,2,3,5,9\n2011,10,12,6,50,6:30,Länsi,0,2,3,5,9\n2011,10,12,6,55,6:40,Länsi,0,2,3,6,0\n2011,10,12,7,0,6:40,Länsi,0,2,3,6,0\n2011,10,12,7,5,6:50,Länsi,0,2,3,6,1\n2011,10,12,7,10,6:50,Länsi,0,2,3,6,1\n2011,10,12,7,20,7:00,Länsi,0,2,3,6,1\n2011,10,12,7,25,7:10,Länsi,0,2,2,6,3\n2011,10,12,7,30,7:10,Länsi,0,2,2,6,3\n2011,10,12,7,35,7:20,Länsi,0,2,3,6,2\n2011,10,12,7,40,7:20,Länsi,0,2,3,6,2\n2011,10,12,7,45,7:30,Luoteis,0,2,4,6,3\n2011,10,12,7,50,7:40,Luoteis,0,3,4,6,2\n2011,10,12,7,55,7:40,Luoteis,0,3,4,6,2\n2011,10,12,8,0,7:40,Luoteis,0,3,4,6,2\n2011,10,12,8,5,7:50,Länsi,0,4,6,6,1\n2011,10,12,8,10,7:50,Länsi,0,4,6,6,1\n2011,10,12,8,15,8:00,Länsi,0,4,5,6,0\n2011,10,12,8,20,8:10,Luoteis,0,6,8,5,7\n2011,10,12,8,25,8:10,Luoteis,0,6,8,5,7\n2011,10,12,8,30,8:10,Luoteis,0,6,8,5,7\n2011,10,12,8,35,8:20,Luoteis,0,6,8,5,5\n2011,10,12,8,40,8:20,Luoteis,0,6,8,5,5\n2011,10,12,8,45,8:30,Luoteis,0,6,7,5,7\n2011,10,12,8,50,8:30,Luoteis,0,6,7,5,7\n2011,10,12,8,55,8:40,Luoteis,0,6,8,5,8\n2011,10,12,9,5,8:50,Luoteis,0,6,7,6,0\n2011,10,12,9,10,9:00,Luoteis,0,6,7,6,0\n2011,10,12,9,15,9:00,Luoteis,0,6,7,6,0\n2011,10,12,9,20,9:10,Luoteis,0,6,8,5,9\n2011,10,12,9,25,9:10,Luoteis,0,6,8,5,9\n2011,10,12,9,30,9:10,Luoteis,0,6,8,5,9\n2011,10,12,9,35,9:20,Luoteis,0,6,7,5,8\n2011,10,12,9,40,9:20,Luoteis,0,6,7,5,8\n2011,10,12,9,45,9:30,Luoteis,0,6,7,5,7\n2011,10,12,9,50,9:40,Länsi,0,5,6,5,6\n2011,10,12,9,55,9:40,Länsi,0,5,6,5,6\n2011,10,12,10,0,9:40,Länsi,0,5,6,5,6\n2011,10,12,10,5,9:50,Länsi,0,5,6,5,5\n2011,10,12,10,10,9:50,Länsi,0,5,6,5,5\n2011,10,12,10,15,10:00,Länsi,0,4,5,5,5\n2011,10,12,10,20,10:00,Länsi,0,4,5,5,5\n2011,10,12,10,25,10:10,Länsi,0,4,5,5,7\n2011,10,12,10,30,10:20,Länsi,0,4,5,5,9\n2011,10,12,10,35,10:20,Länsi,0,4,5,5,9\n2011,10,12,10,40,10:30,Luoteis,0,4,5,5,8\n2011,10,12,10,45,10:30,Luoteis,0,4,5,5,8\n2011,10,12,10,50,10:30,Luoteis,0,4,5,5,8\n2011,10,12,10,55,10:40,Luoteis,0,4,5,5,8\n2011,10,12,11,0,10:40,Luoteis,0,4,5,5,8\n2011,10,12,11,5,10:50,Luoteis,0,4,5,5,9\n2011,10,12,11,10,11:00,Luoteis,0,3,5,5,9\n2011,10,12,11,15,11:00,Luoteis,0,3,5,5,9\n2011,10,12,11,20,11:00,Luoteis,0,3,5,5,9\n2011,10,12,11,25,11:10,Länsi,0,3,4,6,0\n2011,10,12,11,30,11:10,Länsi,0,3,4,6,0\n2011,10,12,11,35,11:20,Luoteis,0,4,5,5,9\n2011,10,12,11,40,11:20,Luoteis,0,4,5,5,9\n2011,10,12,11,45,11:30,Luoteis,0,5,6,5,9\n2011,10,12,11,50,11:30,Luoteis,0,5,6,5,9\n2011,10,12,11,55,11:40,Luoteis,0,4,5,6,0\n2011,10,12,12,0,11:50,Luoteis,0,4,5,6,1\n2011,10,12,12,5,11:50,Luoteis,0,4,5,6,1\n2011,10,12,12,10,11:50,Luoteis,0,4,5,6,1\n2011,10,12,12,15,12:00,Luoteis,0,3,5,6,3\n2011,10,12,12,20,12:00,Luoteis,0,3,5,6,3\n2011,10,12,12,25,12:10,Luoteis,0,2,3,6,3\n2011,10,12,12,30,12:10,Luoteis,0,2,3,6,3\n2011,10,12,12,35,12:20,Luoteis,0,3,5,6,6\n2011,10,12,12,40,12:20,Luoteis,0,3,5,6,6\n2011,10,12,12,45,12:30,Luoteis,0,5,7,6,5\n2011,10,12,12,50,12:30,Luoteis,0,5,7,6,5\n2011,10,12,12,55,12:30,Luoteis,0,5,7,6,5\n2011,10,12,13,0,12:50,Luoteis,0,6,7,6,6\n2011,10,12,13,5,12:50,Luoteis,0,6,7,6,6\n2011,10,12,13,10,12:50,Luoteis,0,6,7,6,6\n2011,10,12,13,15,13:00,Luoteis,0,6,7,6,6\n2011,10,12,13,20,13:00,Luoteis,0,6,7,6,6\n2011,10,12,13,25,13:10,Luoteis,0,5,6,6,7\n2011,10,12,13,30,13:10,Luoteis,0,5,6,6,7\n2011,10,12,13,35,13:10,Luoteis,0,5,6,6,7\n2011,10,12,13,40,13:10,Luoteis,0,5,6,6,7\n2011,10,12,13,45,13:30,Luoteis,0,4,5,7,0\n2011,10,12,13,50,13:30,Luoteis,0,4,5,7,0\n2011,10,12,13,55,13:40,Luoteis,0,4,5,7,1\n2011,10,12,14,0,13:50,Luoteis,0,4,5,7,2\n2011,10,12,14,5,13:50,Luoteis,0,4,5,7,2\n2011,10,12,14,10,14:00,Luoteis,0,4,4,7,4\n2011,10,12,14,15,14:00,Luoteis,0,4,4,7,4\n2011,10,12,14,20,14:10,Luoteis,0,4,5,7,6\n2011,10,12,14,25,14:10,Luoteis,0,4,5,7,6\n2011,10,12,14,30,14:10,Luoteis,0,4,5,7,6\n2011,10,12,14,35,14:10,Luoteis,0,4,5,7,6\n2011,10,12,14,40,14:10,Luoteis,0,4,5,7,6\n2011,10,12,14,45,14:30,Luoteis,0,5,6,7,6\n2011,10,12,14,50,14:40,Luoteis,0,4,5,7,9\n2011,10,12,14,55,14:40,Luoteis,0,4,5,7,9\n2011,10,12,15,0,14:40,Luoteis,0,4,5,7,9\n2011,10,12,15,5,14:50,Luoteis,0,4,5,8,1\n2011,10,12,15,10,15:00,Luoteis,0,4,5,8,3\n2011,10,12,15,15,15:00,Luoteis,0,4,5,8,3\n2011,10,12,15,20,15:00,Luoteis,0,4,5,8,3\n2011,10,12,15,25,15:00,Luoteis,0,4,5,8,3\n2011,10,12,15,30,15:00,Luoteis,0,4,5,8,3\n2011,10,12,15,35,15:20,Länsi,0,3,4,8,8\n2011,10,12,15,40,15:30,Luoteis,0,3,4,8,9\n2011,10,12,15,45,15:30,Luoteis,0,3,4,8,9\n2011,10,12,15,50,15:30,Luoteis,0,3,4,8,9\n2011,10,12,15,55,15:40,Länsi,0,4,6,8,9\n2011,10,12,16,0,15:50,Länsi,0,4,6,9,1\n2011,10,12,16,5,15:50,Länsi,0,4,6,9,1\n2011,10,12,16,10,16:00,Länsi,0,3,4,9,2\n2011,10,12,16,15,16:00,Länsi,0,3,4,9,2\n2011,10,12,16,20,16:00,Länsi,0,3,4,9,2\n2011,10,12,16,25,16:10,Länsi,0,4,5,8,8\n2011,10,12,16,30,16:20,Länsi,0,7,8,8,9\n2011,10,12,16,35,16:20,Länsi,0,7,8,8,9\n2011,10,12,16,40,16:20,Länsi,0,7,8,8,9\n2011,10,12,16,45,16:30,Länsi,0,6,8,8,6\n2011,10,12,16,50,16:40,Länsi,0,5,6,8,5\n2011,10,12,16,55,16:40,Länsi,0,5,6,8,5\n2011,10,12,17,0,16:50,Länsi,0,5,6,8,3\n2011,10,12,17,5,16:50,Länsi,0,5,6,8,3\n2011,10,12,17,10,16:50,Länsi,0,5,6,8,3\n2011,10,12,17,15,17:00,Länsi,0,5,5,8,3\n2011,10,12,17,20,17:10,Länsi,0,4,5,8,4\n2011,10,12,17,25,17:10,Länsi,0,4,5,8,4\n2011,10,12,17,30,17:20,Länsi,0,4,5,8,4\n2011,10,12,17,35,17:20,Länsi,0,4,5,8,4\n2011,10,12,17,40,17:30,Luoteis,0,4,5,8,4\n2011,10,12,17,45,17:30,Luoteis,0,4,5,8,4\n2011,10,12,17,50,17:30,Luoteis,0,4,5,8,4\n2011,10,12,18,0,17:40,Länsi,0,6,10,7,9\n2011,10,12,18,5,17:50,Länsi,0,6,8,7,6\n2011,10,12,18,10,17:50,Länsi,0,6,8,7,6\n2011,10,12,18,15,18:00,Länsi,0,4,6,7,5\n2011,10,12,18,20,18:00,Länsi,0,4,6,7,5\n2011,10,12,18,25,18:10,Länsi,0,4,5,7,8\n2011,10,12,18,30,18:10,Länsi,0,4,5,7,8\n2011,10,12,18,35,18:20,Länsi,0,6,9,7,5\n2011,10,12,18,40,18:20,Länsi,0,6,9,7,5\n2011,10,12,18,45,18:30,Länsi,0,4,6,7,6\n2011,10,12,18,50,18:30,Länsi,0,4,6,7,6\n2011,10,12,18,55,18:40,Länsi,0,4,5,7,7\n2011,10,12,19,0,18:50,Länsi,0,4,5,7,8\n2011,10,12,19,5,18:50,Länsi,0,4,5,7,8\n2011,10,12,19,10,18:50,Länsi,0,4,5,7,8\n2011,10,12,19,15,19:00,Länsi,0,3,5,7,8\n2011,10,12,19,20,19:00,Länsi,0,3,5,7,8\n2011,10,12,19,25,19:10,Länsi,0,4,5,7,9\n2011,10,12,19,30,19:10,Länsi,0,4,5,7,9\n2011,10,12,19,35,19:20,Länsi,0,5,6,8,0\n2011,10,12,19,40,19:20,Länsi,0,5,6,8,0\n2011,10,12,19,45,19:30,Länsi,0,5,6,8,0\n2011,10,12,19,50,19:30,Länsi,0,5,6,8,0\n2011,10,12,19,55,19:40,Länsi,0,5,7,7,9\n2011,10,12,20,0,19:50,Länsi,0,6,7,7,8\n2011,10,12,20,5,19:50,Länsi,0,6,7,7,8\n2011,10,12,20,10,20:00,Länsi,0,6,7,7,6\n2011,10,12,20,15,20:00,Länsi,0,6,7,7,6\n2011,10,12,20,20,20:00,Länsi,0,6,7,7,6\n2011,10,12,20,25,20:10,Luoteis,0,6,6,7,3\n2011,10,12,20,30,20:10,Luoteis,0,6,6,7,3\n2011,10,12,20,35,20:20,Luoteis,0,5,7,7,2\n2011,10,12,20,40,20:20,Luoteis,0,5,7,7,2\n2011,10,12,20,45,20:30,Luoteis,0,6,7,7,0\n2011,10,12,20,50,20:40,Luoteis,0,6,8,7,0\n2011,10,12,20,55,20:40,Luoteis,0,6,8,7,0\n2011,10,12,21,0,20:40,Luoteis,0,6,8,7,0\n2011,10,12,21,5,20:50,Luoteis,0,7,8,6,9\n2011,10,12,21,10,20:50,Luoteis,0,7,8,6,9\n2011,10,12,21,15,21:00,Luoteis,0,7,8,6,7\n2011,10,12,21,20,21:00,Luoteis,0,7,8,6,7\n2011,10,12,21,25,21:10,Luoteis,0,7,8,6,7\n2011,10,12,21,30,21:20,Luoteis,0,7,9,6,6\n2011,10,12,21,35,21:20,Luoteis,0,7,9,6,6\n2011,10,12,21,40,21:20,Luoteis,0,7,9,6,6\n2011,10,12,21,45,21:30,Luoteis,0,8,9,6,5\n2011,10,12,21,50,21:30,Luoteis,0,8,9,6,5\n2011,10,12,21,55,21:40,Luoteis,0,7,8,6,3\n2011,10,12,22,0,21:40,Luoteis,0,7,8,6,3\n2011,10,12,22,5,21:50,Luoteis,0,7,8,6,1\n2011,10,12,22,10,21:50,Luoteis,0,7,8,6,1\n2011,10,12,22,20,22:10,Luoteis,0,7,9,6,0\n2011,10,12,22,25,22:10,Luoteis,0,7,9,6,0\n2011,10,12,22,30,22:10,Luoteis,0,7,9,6,0\n2011,10,12,22,35,22:20,Luoteis,0,7,9,5,9\n2011,10,12,22,40,22:20,Luoteis,0,7,9,5,9\n2011,10,12,22,45,22:30,Luoteis,0,7,8,5,8\n2011,10,12,22,50,22:30,Luoteis,0,7,8,5,8\n2011,10,12,22,55,22:40,Luoteis,0,7,9,5,8\n2011,10,12,23,0,22:40,Luoteis,0,7,9,5,8\n2011,10,12,23,5,22:50,Luoteis,0,7,8,5,9\n2011,10,12,23,10,22:50,Luoteis,0,7,8,5,9\n2011,10,12,23,15,23:00,Luoteis,0,7,8,5,8\n2011,10,12,23,20,23:00,Luoteis,0,7,8,5,8\n2011,10,12,23,25,23:10,Luoteis,0,7,9,5,7\n2011,10,12,23,30,23:10,Luoteis,0,7,9,5,7\n2011,10,12,23,35,23:20,Luoteis,0,7,9,5,6\n2011,10,12,23,40,23:20,Luoteis,0,7,9,5,6\n2011,10,12,23,45,23:30,Luoteis,0,7,9,5,7\n2011,10,12,23,50,23:30,Luoteis,0,7,9,5,7\n2011,10,12,23,55,23:40,Luoteis,0,8,10,5,6";

var data = new Array();

function parseData() 
{
    var sa = stationData.split("\n");
    var l;
    for (l = 0; l < sa.length; l++) {
        var fields = sa[l].split(",");
        var time = fields[5];
        time = time.split(":");
        var checkHour = parseInt(fields[3]);
        var hour = parseInt(time[0]);
        if (hour > checkHour) {// value from the day before
            hour -= 24;
        }
        var minute = parseInt(time[1]);
        var wind = parseInt(fields[8]);
        var d = new Array();
        d.push(hour*60+minute);
        d.push(wind);
        data.push(d);
    }
}

function moveTo(x, y)
{
    debug("x: " + x);
    
    var p1 = $V([x, y, 1]);
    p1 = viewMatrix.multiply(p1);
    context.moveTo(p1.e(1), p1.e(2));
}

function lineTo(x, y)
{
    var p1 = $V([x, y, 1]);
    p1 = viewMatrix.multiply(p1);
    context.lineTo(p1.e(1), p1.e(2));
}

function stroke()
{
    context.stroke();
}

function drawBox() 
{
    moveTo(0, 0);
    lineTo(drawAreaWidth, 0);
    lineTo(drawAreaWidth, drawAreaHeight);
    lineTo(0, drawAreaHeight);
    lineTo(0, 0);
    stroke();
}

function drawLabels() 
{
    context.fillStyle    = '#000000';
    var y;
    for (y = 0; y < dataMaxY; y += 6) {
        var p1 = $V([0, y, 1]);
        p1 = viewMatrix.multiply(p1);
        context.fillText(y + "", 2, p1.e(2));
        moveTo(dataMinX, y);
        lineTo(dataMaxX, y);
        stroke();
    }
    var p1 = $V([0, dataMaxY, 1]);
    p1 = viewMatrix.multiply(p1);
    context.fillText(dataMaxY + "", 2, p1.e(2));
}

function translateMatrix(x, y) 
{
    return $M([
                  [1, 0, x],
                  [0, 1, y],
                  [0, 0, 1]
               ]);
}

function scaleMatrix(x, y) 
{
    return $M([
                  [x, 0, 0],
                  [0, y, 0],
                  [0, 0, 1]
               ]);
}

function flipYMatrix()
{
    return $M([
                  [1, 0, 0],
                  [0, -1, 0],
                  [0, 0, 1]
               ]);
}

function drawGraph()
{
    canvas = document.getElementById("graphCanvas");
    context = canvas.getContext("2d");

    drawAreaWidth = (canvas.width-leftMargin-rightMargin);
    drawAreaHeight = (canvas.height-bottomMargin-topMargin);

    viewMatrix = translateMatrix(0, canvas.height);
    viewMatrix = viewMatrix.multiply(flipYMatrix());
    viewMatrix = viewMatrix.multiply(translateMatrix(leftMargin, bottomMargin));
    viewMatrix = viewMatrix.multiply(scaleMatrix(drawAreaWidth / canvas.width,
                                                 drawAreaHeight / canvas.height));
    drawBox();
    
    parseData();
    
    var i;
    dataMaxX = 0;
    dataMinX = 1000000;
    dataMaxY = 0;

    for (i = 0; i < data.length; i++) {
        if (data[i][0] > dataMaxX) {
            dataMaxX = data[i][0];
        }
        if (data[i][0] < dataMinX) {
            dataMinX = data[i][0];
        }
        if (data[i][1] > dataMaxY) {
            dataMaxY = data[i][1];
        }
    }

    viewMatrix = viewMatrix.multiply(scaleMatrix(drawAreaWidth / (dataMaxX - dataMinX),
                                                 drawAreaHeight/ dataMaxY));
    viewMatrix = viewMatrix.multiply(translateMatrix(-dataMinX, 0));
    drawLabels();
    debug("data.length: " + data.length);
    
//    debugMatrix(viewMatrix);

    for (i = 0; i < data.length; i++) {
        if (i == 0) {
            moveTo(data[i][0], data[i][1]);
        } else {
            lineTo(data[i][0], data[i][1]);
        }
    }
    stroke();
}

function debugMatrix(m)
{
    debug("vm:<br/>" + m.e(1,1) + " " + m.e(1,2) + " " + m.e(1,3) + "<br/>" + 
          m.e(2,1) + " " + m.e(2,2) + " " + m.e(2,3) + "<br/>" + 
          m.e(3,1) + " " + m.e(3,2) + " " + m.e(3,3));
}

function debugVector(v)
{
    debug("v: " + v.e(1) + " " + v.e(2) + " " + v.e(3));
}

function debug(s) 
{
    document.getElementById('debug').innerHTML = document.getElementById('debug').innerHTML + "<br/>" + s;
}
